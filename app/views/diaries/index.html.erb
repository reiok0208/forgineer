<div class="row">
  <div class="col-xs-7 col-xs-offset-1">
    <% if params[:search].present? %><!--検索フォームからの遷移-->
      <input class="search" type="hidden" name="search" value="<%= params[:search] %>">
      <h2><%= "フォーム検索：#{params[:search]}" %></h2>
    <% elsif params[:user_id].present? %><!--ユーザー詳細からの遷移-->
      <h2><%= "#{params[:nickname]}さんの投稿日記" %></h2>
    <% elsif params[:tag_id].present? %><!--人気タグからの遷移-->
      <input class="name" type="hidden" name="name" value="<%= params[:name] %>">
      <input class="tag" type="hidden" name="tag" value="<%= params[:tag_id] %>">
      <h2><%= "タグ検索：#{params[:name]}" %></h2>
    <% else %>
      <h2>新着日記</h2>
    <% end %>
    <div class="field">
          <% if params[:option].present? %>
            <%= select_tag :sort, options_for_select("#{params[:option]}": "","日記の新しい順": "日記の新しい順","日記の古い順": "日記の古い順","日記の更新日順": "日記の更新日順", "お気に入りが多い順": "お気に入りが多い順","コメントが多い順": "コメントが多い順","PVが多い順": "PVが多い順"), onChange: "func(this.value)", style:"font-size:20px; margin:10px;" %>
          <% else %>
            <%= select_tag :sort, options_for_select("日記の新しい順": "日記の新しい順","日記の古い順": "日記の古い順","日記の更新日順": "日記の更新日順","お気に入りが多い順": "お気に入りが多い順","コメントが多い順": "コメントが多い順","PVが多い順": "PVが多い順"), onChange: "func(this.value)", style:"font-size:20px; margin:10px;" %>
          <% end %>
        </div>
    <div class="diary-box">
      <% @diaries.each do |diary| %>
        <div class="diary_<%= diary.id %>">
          <%= render "layouts/diary_index", diary: diary %>
        </div>
      <% end %>
      <div style="text-align: center;">
        <%= paginate @diaries %>
      </div>
    </div>
  </div>

  <% if user_signed_in? %>
    <%= render "layouts/diary_index_side", tags: @tags, most_viewed: @most_viewed %>
  <% else %>
    <div class="col-xs-2 diary-side-box" style="height:1000px;">日記投稿・編集、文字列検索やタグ検索機能、日記ランキング、フォロー機能、お気に入り機能、コメント履歴機能は会員限定機能です</div>
  <% end %>
</div>

<script>
    function func(value) {
      var search = $(".search").val();
      var name = $(".name").val();
      var tag = $(".tag").val();
      if (typeof search !== 'undefined') {
        window.location.replace('/diaries?search=' + search + '&option=' + value);
      }else if (typeof tag !== 'undefined'){
        window.location.replace('/diaries?name=' + name + '&tag_id=' + tag + '&option=' + value);
      }else{
        window.location.replace('/diaries?option=' + value );
      }
    }
</script>